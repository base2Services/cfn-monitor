templates:
  EcsCICheck:
    ECSContianerInstancesDisconnected:
      AlarmActions: crit
      Namespace: EcsCICheck
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: Cluster
      Statistic: Maximum
      Threshold: 0
      Period: 60
      EvaluationPeriods: 2
      MetricName: ECSContianerInstancesDisconnected
      TreatMissingData: notBreaching
  HttpCheck:
    EndpointAvailable:
      AlarmActions: crit
      Namespace: HttpCheck
      ComparisonOperator: LessThanThreshold
      Dimensions: [ { Name: 'Endpoint', Value: { 'Fn::Sub': ['${endpoint}', {'env': { Ref: 'EnvironmentName' } } ] } } ]
      Statistic: Maximum
      Threshold: 1
      Period: 60
      EvaluationPeriods: 2
      MetricName: Available
    EndpointTimeTaken:
      AlarmActions: crit
      Namespace: HttpCheck
      ComparisonOperator: GreaterThanThreshold
      Dimensions: [ { Name: 'Endpoint', Value: { 'Fn::Sub': ['${endpoint}', {'env': { Ref: 'EnvironmentName' } } ] } } ]
      Statistic: Minimum
      Threshold: 1000
      Period: 300
      EvaluationPeriods: 1
      MetricName: TimeTaken
    EndpointStatusCodeMatch:
      AlarmActions: crit
      Namespace: HttpCheck
      ComparisonOperator: LessThanThreshold
      Dimensions: [ { Name: 'Endpoint', Value: { 'Fn::Sub': ['${endpoint}', {'env': { Ref: 'EnvironmentName' } } ] } } ]
      Statistic: Maximum
      Threshold: 1
      Period: 60
      EvaluationPeriods: 2
      MetricName: StatusCodeMatch
  HttpCheckBody:
    EndpointResponseBodyRegexMatch:
      AlarmActions: crit
      Namespace: HttpCheck
      ComparisonOperator: LessThanThreshold
      Dimensions: [ { Name: 'Endpoint', Value: { 'Fn::Sub': ['${endpoint}', {'env': { Ref: 'EnvironmentName' } } ] } } ]
      Statistic: Maximum
      Threshold: 1
      Period: 60
      EvaluationPeriods: 2
      MetricName: ResponseBodyRegexMatch
  Services:
    FailedService:
      AlarmActions: warn
      Namespace: ServiceChecks
      ComparisonOperator: GreaterThanThreshold
      Dimensions: [ { Name: 'Service', Value: '${resource}' }, { Name: 'Environment', Value: { Ref: 'EnvironmentName' } } ]
      Statistic: Maximum
      Threshold: 0
      Period: 60
      EvaluationPeriods: 2
      MetricName: Failed_Service
      AlarmDescription: { 'Fn::Join': [ ' ', [ Ref: 'MonitoredStack', { 'Fn::Sub': ['${resource}', {'env': { Ref: 'EnvironmentName' } } ] }, '${alarmName}' ] ] }
      TreatMissingData: notBreaching
    # FailedSSMAgent:
    #   AlarmActions: warn
    #   Namespace: ServiceChecks
    #   ComparisonOperator: GreaterThanThreshold
    #   Dimensions: [ { Name: 'Environment', Value: { Ref: 'EnvironmentName' } } ]
    #   Statistic: Maximum
    #   Threshold: 0
    #   Period: 60
    #   EvaluationPeriods: 2
    #   MetricName: Failed_SSM_Agent
    #   AlarmDescription: { 'Fn::Join': [ ' ', [ Ref: 'MonitoredStack', { 'Fn::Sub': ['${resource}', {'env': { Ref: 'EnvironmentName' } } ] }, '${alarmName}' ] ] }
    #   TreatMissingData: notBreaching
  Ssl:
    Crit:
      AlarmActions: crit
      Namespace: SSL
      ComparisonOperator: LessThanThreshold
      Dimensions: [ { Name: 'URL', Value: '${resource}' } ]
      Statistic: Maximum
      Threshold: 5   # 5 days
      Period: 60
      EvaluationPeriods: 1
      MetricName: ExpiresInDays
      AlarmDescription: { 'Fn::Join': [ ' ', [ '${resource}', '${templateName}' ] ] }
    Task:
      AlarmActions: task
      Namespace: SSL
      ComparisonOperator: LessThanThreshold
      Dimensions: [ { Name: 'URL', Value: '${resource}' } ]
      Statistic: Maximum
      Threshold: 30   # 30 days
      Period: 60
      EvaluationPeriods: 1
      MetricName: ExpiresInDays
      AlarmDescription: { 'Fn::Join': [ ' ', [ '${resource}', '${templateName}' ] ] }
  Sql:
    Crit:
      # An SQL check is highly customisable; this config should be overriden by
      # a custom template.
      AlarmActions: crit
      Namespace: SQL
      ComparisonOperator: GreaterThanOrEqualToThreshold
      Dimensions: [ { Name: 'Host', Value: '' } ]
      Statistic: Maximum
      Threshold: 1
      Period: 60
      EvaluationPeriods: 1
      MetricName: Your_Metric_Name
      AlarmDescription: { 'Fn::Join': [ ' ', [ '${resource}', '${templateName}' ] ] }
  Dns:
    Crit:
      AlarmActions: crit
      Namespace: DNS
      ComparisonOperator: LessThanThreshold
      Dimensions: [ { Name: 'Domain', Value: '${resource}' } ]
      Statistic: Maximum
      Threshold: 5 # 5 days
      Period: 60
      EvaluationPeriods: 1
      MetricName: ExpiresInDays
      AlarmDescription: { 'Fn::Join': [ ' ', [ '${resource}', '${templateName}' ] ] }
    Task:
      AlarmActions: task
      Namespace: DNS
      ComparisonOperator: LessThanThreshold
      Dimensions: [ { Name: 'Domain', Value: '${resource}' } ]
      Statistic: Maximum
      Threshold: 30   # 30 days
      Period: 60
      EvaluationPeriods: 1
      MetricName: ExpiresInDays
      AlarmDescription: { 'Fn::Join': [ ' ', [ '${resource}', '${templateName}' ] ] }
  Nrpe:
    Warn:
      AlarmActions: warn
      Namespace: NRPE
      ComparisonOperator: GreaterThanThreshold
      Dimensions: [ { Name: 'Host', Value: { 'Fn::Join': [ '-', [ { 'Fn::Sub': ['${env}', {'env': { Ref: 'EnvironmentName' } } ] }, '${resource}' ] ] } } ]
      Statistic: Maximum
      Threshold: 0
      Period: 60
      EvaluationPeriods: 2
      MetricName: ${cmd}
      TreatMissingData: breaching
      AlarmDescription: { 'Fn::Join': [ ' ', [ Ref: 'MonitoredStack', { 'Fn::Sub': ['${resource}', {'env': { Ref: 'EnvironmentName' } } ] }, '${templateName}', '${cmd}', '${alarmName}' ] ] }
    Crit:
      AlarmActions: crit
      Namespace: NRPE
      ComparisonOperator: GreaterThanThreshold
      Dimensions: [ { Name: 'Host', Value: { 'Fn::Join': [ '-', [ { 'Fn::Sub': ['${env}', {'env': { Ref: 'EnvironmentName' } } ] }, '${resource}' ] ] } } ]
      Statistic: Maximum
      Threshold: 1
      Period: 60
      EvaluationPeriods: 2
      MetricName: ${cmd}
      AlarmDescription: { 'Fn::Join': [ ' ', [ Ref: 'MonitoredStack', { 'Fn::Sub': ['${resource}', {'env': { Ref: 'EnvironmentName' } } ] }, '${templateName}', '${cmd}', '${alarmName}' ] ] }
  LambdaMetrics: # Lambda Functions deployed with a Function Name
    Errors:
      AlarmActions: crit
      Namespace: AWS/Lambda
      ComparisonOperator: GreaterThanThreshold
      Dimensions: [ { Name: 'FunctionName', Value: { 'Fn::Sub': ['${metric}', {'env': { Ref: 'EnvironmentName' } } ] } } ]
      Statistic: Average
      Threshold: 0.5
      Period: 60
      EvaluationPeriods: 5
      MetricName: Errors
      TreatMissingData: notBreaching
  ElasticLoadBalancer: # AWS::ElasticLoadBalancing::LoadBalancer
    HealthyHosts:
      AlarmActions: crit
      Namespace: AWS/ELB
      MetricName: HealthyHostCount
      ComparisonOperator: LessThanThreshold
      DimensionsName: LoadBalancerName
      Statistic: Minimum
      Threshold: 2
      Threshold.development: 1
      EvaluationPeriods: 1
      TreatMissingData: notBreaching
    UnHealthyHosts:
      AlarmActions: warn
      Namespace: AWS/ELB
      MetricName: UnHealthyHostCount
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: LoadBalancerName
      Statistic: Maximum
      Threshold: 0
      EvaluationPeriods: 10
      TreatMissingData: notBreaching
  ApplicationELBTargetGroup: # AWS::ElasticLoadBalancingV2::TargetGroup / AWS::ElasticLoadBalancingV2::LoadBalancer where type: application
    HealthyHosts:
      AlarmActions: crit
      Namespace: AWS/ApplicationELB
      MetricName: HealthyHostCount
      ComparisonOperator: LessThanThreshold
      DimensionsName: TargetGroup/LoadBalancer
      Statistic: Minimum
      Threshold: 2
      Threshold.development: 1
      EvaluationPeriods: 1
      TreatMissingData: breaching
    UnHealthyHosts:
      AlarmActions: warn
      Namespace: AWS/ApplicationELB
      MetricName: UnHealthyHostCount
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: TargetGroup/LoadBalancer
      Statistic: Maximum
      Threshold: 0
      EvaluationPeriods: 10
      TreatMissingData: notBreaching
    TargetResponseTime:
      AlarmActions: crit
      Namespace: AWS/ApplicationELB
      MetricName: TargetResponseTime
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: TargetGroup/LoadBalancer
      Statistic: Average
      Threshold: 5
      EvaluationPeriods: 5
      TreatMissingData: notBreaching
  NetworkELBTargetGroup: # AWS::ElasticLoadBalancingV2::TargetGroup / AWS::ElasticLoadBalancingV2::LoadBalancer where type: network
    HealthyHosts:
      AlarmActions: crit
      Namespace: AWS/NetworkELB
      MetricName: HealthyHostCount
      ComparisonOperator: LessThanThreshold
      DimensionsName: TargetGroup/LoadBalancer
      Statistic: Minimum
      Threshold: 2
      Threshold.development: 1
      EvaluationPeriods: 1
      TreatMissingData: breaching
    UnHealthyHosts:
      AlarmActions: warn
      Namespace: AWS/NetworkELB
      MetricName: UnHealthyHostCount
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: TargetGroup/LoadBalancer
      Statistic: Maximum
      Threshold: 0
      EvaluationPeriods: 10
      TreatMissingData: notBreaching
    TargetResponseTime:
      AlarmActions: crit
      Namespace: AWS/NetworkELB
      MetricName: TargetResponseTime
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: TargetGroup/LoadBalancer
      Statistic: Average
      Threshold: 5
      EvaluationPeriods: 5
      TreatMissingData: notBreaching
  AutoScalingGroup: # AWS::AutoScaling::AutoScalingGroup
    CPUUtilizationHighBase:
      AlarmActions: warn
      Namespace: AWS/EC2
      MetricName: CPUUtilization
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: AutoScalingGroupName
      Statistic: Minimum
      Threshold: 75
      EvaluationPeriods: 60
      TreatMissingData: notBreaching
    StatusCheckFailed:
      AlarmActions: warn
      Namespace: AWS/EC2
      MetricName: StatusCheckFailed
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: AutoScalingGroupName
      Statistic: Maximum
      Threshold: 0
      EvaluationPeriods: 10
  Ec2Instance: # AWS::EC2::Instance
    CPUUtilizationHigh:
      AlarmActions: crit
      Namespace: AWS/EC2
      MetricName: CPUUtilization
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: InstanceId
      Statistic: Minimum
      Threshold: 90
      EvaluationPeriods: 10
    StatusCheckFailed:
      AlarmActions: crit
      Namespace: AWS/EC2
      MetricName: StatusCheckFailed
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: InstanceId
      Statistic: Maximum
      Threshold: 0
      EvaluationPeriods: 10
  RDSInstance: # AWS::RDS::DBInstance
    FreeStorageSpaceCrit:
      AlarmActions: crit
      Namespace: AWS/RDS
      MetricName: FreeStorageSpace
      ComparisonOperator: LessThanThreshold
      DimensionsName: DBInstanceIdentifier
      Statistic: Minimum
      Threshold: 50000000000
      Threshold.development: 10000000000
      EvaluationPeriods: 1
    FreeStorageSpaceTask:
      AlarmActions: task
      Namespace: AWS/RDS
      MetricName: FreeStorageSpace
      ComparisonOperator: LessThanThreshold
      DimensionsName: DBInstanceIdentifier
      Statistic: Minimum
      Threshold: 100000000000
      Threshold.development: 20000000000
      EvaluationPeriods: 1
    CPUUtilizationHighSpike:
      AlarmActions: crit
      Namespace: AWS/RDS
      MetricName: CPUUtilization
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: DBInstanceIdentifier
      Statistic: Minimum
      Threshold: 95
      EvaluationPeriods: 10
    CPUUtilizationHighBase:
      AlarmActions: warn
      Namespace: AWS/RDS
      MetricName: CPUUtilization
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: DBInstanceIdentifier
      Statistic: Minimum
      Threshold: 75
      EvaluationPeriods: 60
  DBCluster: # AWS::RDS::DBCluster
    CPUUtilizationHighSpike:
      AlarmActions: crit
      Namespace: AWS/RDS
      MetricName: CPUUtilization
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: DBClusterIdentifier
      Statistic: Minimum
      Threshold: 95
      EvaluationPeriods: 10
    CPUUtilizationHighBase:
      AlarmActions: warn
      Namespace: AWS/RDS
      MetricName: CPUUtilization
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: DBClusterIdentifier
      Statistic: Minimum
      Threshold: 75
      EvaluationPeriods: 60
  RedshiftCluster: # AWS::Redshift::Cluster
    CPUUtilizationHighSpike:
      AlarmActions: crit
      Namespace: AWS/Redshift
      MetricName: CPUUtilization
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: ClusterIdentifier
      Statistic: Minimum
      Threshold: 95
      EvaluationPeriods: 10
    CPUUtilizationHighBase:
      AlarmActions: warn
      Namespace: AWS/Redshift
      MetricName: CPUUtilization
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: ClusterIdentifier
      Statistic: Minimum
      Threshold: 75
      EvaluationPeriods: 60
    UnHealthyCluster:
      AlarmActions: crit
      Namespace: AWS/Redshift
      MetricName: HealthStatus
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: ClusterIdentifier
      Statistic: Maximum
      Threshold: 0
      EvaluationPeriods: 10
      TreatMissingData: notBreaching
  ECSCluster: # AWS::ECS::Cluster
    MemoryUtilizationWarn:
      AlarmActions: warn
      Namespace: AWS/ECS
      MetricName: MemoryUtilization
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: ClusterName
      Statistic: Maximum
      Threshold: 75
      EvaluationPeriods: 10
    MemoryUtilizationCrit:
      AlarmActions: crit
      Namespace: AWS/ECS
      MetricName: MemoryUtilization
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: ClusterName
      Statistic: Maximum
      Threshold: 95
      EvaluationPeriods: 10
    CPUUtilizationHighBase:
      AlarmActions: warn
      Namespace: AWS/ECS
      MetricName: CPUUtilization
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: ClusterName
      Statistic: Minimum
      Threshold: 75
      EvaluationPeriods: 10
  ECSService: #AWS::ECS::Service
    UnHealthyTask:
      AlarmActions: crit
      MetricName: MemoryUtilization
      Namespace: AWS/ECS
      Statistic: SampleCount
      DimensionsName: ServiceName/ClusterName
      Period: 60
      EvaluationPeriods: 10
      DatapointsToAlarm: 8
      Threshold: 0.0
      ComparisonOperator: LessThanOrEqualToThreshold
      TreatMissingData: breaching
  ECSTasks:
    UnHealthyTaskWarn:
      AlarmActions: warn
      MetricName: MemoryUtilization
      Namespace: AWS/ECS
      Statistic: SampleCount
      DimensionsName: ServiceName/ClusterName
      Period: 60
      EvaluationPeriods: 10
      DatapointsToAlarm: 10
      Threshold: 1.0
      ComparisonOperator: LessThanOrEqualToThreshold
      TreatMissingData: breaching
  ElastiCacheReplicationGroup: # AWS::ElastiCache::ReplicationGroup
    FreeableMemoryWarn:
      AlarmActions: warn
      Namespace: AWS/ElastiCache
      MetricName: FreeableMemory
      ComparisonOperator: LessThanThreshold
      DimensionsName: CacheClusterId
      Statistic: Maximum
      Threshold: 100000000
      EvaluationPeriods: 10
    CPUUtilizationHighBase:
      AlarmActions: warn
      Namespace: AWS/ElastiCache
      MetricName: CPUUtilization
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: CacheClusterId
      Statistic: Minimum
      Threshold: 75
      EvaluationPeriods: 10
    CurrentConnectionsTask:
      AlarmActions: task
      Namespace: AWS/ElastiCache
      MetricName: CurrConnections
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: CacheClusterId
      Statistic: Maximum
      Threshold: 50000
      EvaluationPeriods: 10
    CurrentConnectionsCrit:
      AlarmActions: crit
      Namespace: AWS/ElastiCache
      MetricName: CurrConnections
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: CacheClusterId
      Statistic: Maximum
      Threshold: 60000
      EvaluationPeriods: 10
  ElasticFileSystem: # AWS::EFS::FileSystem
    PercentIOLimitHigh:
      AlarmActions: crit
      Namespace: AWS/EFS
      MetricName: PercentIOLimit
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: FileSystemId
      Statistic: Minimum
      Threshold: 90
      EvaluationPeriods: 5
  ApiGateway: #AWS:ApiGateway
    ApiEndpoint5xx:
      AlarmActions: warn
      Namespace: AWS/ApiGateway
      MetricName: 5XXError
      ComparisonOperator: GreaterThanThreshold
      #DimensionsName: ApiName
      Dimensions: [ { Name: 'ApiName', Value: '${name}' }]
      Statistic: Sum
      Threshold: 5
      EvaluationPeriods: 2
      TreatMissingData: notBreaching
    ApiEndpoint4xx:
      AlarmActions: warn
      Namespace: AWS/ApiGateway
      MetricName: 4XXError
      ComparisonOperator: GreaterThanThreshold
      #DimensionsName: ApiName
      Dimensions: [ { Name: 'ApiName', Value: '${name}' }]
      Statistic: Sum
      Threshold: 5
      EvaluationPeriods: 2
      TreatMissingData: notBreaching
    Latency:
      AlarmActions: warn
      Namespace: AWS/ApiGateway
      MetricName: Latency
      ComparisonOperator: GreaterThanThreshold
      #DimensionsName: ApiName
      Dimensions: [ { Name: 'ApiName', Value: '${name}' }]
      Statistic: Average
      Threshold: 1000
      EvaluationPeriods: 2
  DynamoDBTable: #AWS::DynamoDB::Table
    DynamoDBReadUsage:
      AlarmActions: warn
      Namespace: AWS/DynamoDB
      MetricName: ConsumedReadCapacityUnits
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: TableName
      Statistic: Sum
      Threshold: 80
      EvaluationPeriods: 2
    DynamoDBWriteUsage:
      AlarmActions: warn
      Namespace: AWS/DynamoDB
      MetricName: ConsumedWriteCapacityUnits
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: TableName
      Statistic: Sum
      Threshold: 80
      EvaluationPeriods: 2
    DynamoDBReadThrottleEvents:
      AlarmActions: warn
      Namespace: AWS/DynamoDB
      MetricName: ReadThrottleEvents
      ComparisonOperator: GreaterThanOrEqualToThreshold
      DimensionsName: TableName
      Statistic: Sum
      Threshold: 1
      EvaluationPeriods: 2
      TreatMissingData: notBreaching
    DynamoDBWriteThrottleEvents:
      AlarmActions: warn
      Namespace: AWS/DynamoDB
      MetricName: WriteThrottleEvents
      ComparisonOperator: GreaterThanOrEqualToThreshold
      DimensionsName: TableName
      Statistic: Sum
      Threshold: 1
      EvaluationPeriods: 2
      TreatMissingData: notBreaching
  ElasticLoadBalancerSingleInstance: # AWS::ElasticLoadBalancing::LoadBalancer
    HealthyHosts:
      AlarmActions: crit
      Namespace: AWS/ELB
      MetricName: HealthyHostCount
      ComparisonOperator: LessThanThreshold
      DimensionsName: LoadBalancerName
      Statistic: Minimum
      Threshold: 1
      Threshold.development: 1
      EvaluationPeriods: 1
      TreatMissingData: notBreaching
    UnHealthyHosts:
      AlarmActions: warn
      Namespace: AWS/ELB
      MetricName: UnHealthyHostCount
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: LoadBalancerName
      Statistic: Maximum
      Threshold: 0
      EvaluationPeriods: 10
      TreatMissingData: notBreaching

  # Custom metric checks. The dimensions are configured in the CloudWatch agent's config on the instance.
  DiskSpaceCheck:
    CritLowDiskSpaceRootPath:
      AlarmActions: crit
      Namespace: CWAgent
      ComparisonOperator: GreaterThanThreshold
      Dimensions: [ { Name: 'path', Value: '/' }, { Name: 'host', Value: "${metric}" }, { Name: 'device', Value: 'xvda1' }, { Name: 'fstype', Value: 'ext4' } ]
      Statistic: Maximum
      Threshold: 85   # Percentage used
      Period: 60
      EvaluationPeriods: 1
      MetricName: DiskSpaceUsedPercent
      TreatMissingData: breaching
    WarnLowDiskSpaceRootPath:
      AlarmActions: warn
      Namespace: CWAgent
      ComparisonOperator: GreaterThanThreshold
      Dimensions: [ { Name: 'path', Value: '/' }, { Name: 'host', Value: "${metric}" }, { Name: 'device', Value: 'xvda1' }, { Name: 'fstype', Value: 'ext4' } ]
      Statistic: Maximum
      Threshold: 75   # Percentage used
      Period: 60
      EvaluationPeriods: 1
      MetricName: DiskSpaceUsedPercent
      TreatMissingData: breaching
    CritLowDiskSpaceDataPath:
      AlarmActions: crit
      Namespace: CWAgent
      ComparisonOperator: GreaterThanThreshold
      Dimensions: [ { Name: 'path', Value: '/data' }, { Name: 'host', Value: "${metric}" }, { Name: 'device', Value: 'xvdf' }, { Name: 'fstype', Value: 'ext4' } ]
      Statistic: Maximum
      Threshold: 85   # Percentage used
      Period: 60
      EvaluationPeriods: 1
      MetricName: DiskSpaceUsedPercent
      TreatMissingData: breaching
    WarnLowDiskSpaceDataPath:
      AlarmActions: warn
      Namespace: CWAgent
      ComparisonOperator: GreaterThanThreshold
      Dimensions: [ { Name: 'path', Value: '/data' }, { Name: 'host', Value: "${metric}" }, { Name: 'device', Value: 'xvdf' }, { Name: 'fstype', Value: 'ext4' } ]
      Statistic: Maximum
      Threshold: 75   # Percentage used
      Period: 60
      EvaluationPeriods: 1
      MetricName: DiskSpaceUsedPercent
      TreatMissingData: breaching
    CritLowDiskSpaceDockerPath:
      AlarmActions: crit
      Namespace: CWAgent
      ComparisonOperator: GreaterThanThreshold
      Dimensions: [ { Name: 'path', Value: '/var/lib/docker' }, { Name: 'host', Value: "${metric}" }, { Name: 'device', Value: 'xvdcz' }, { Name: 'fstype', Value: 'ext4' } ]
      Statistic: Maximum
      Threshold: 85   # Percentage used
      Period: 60
      EvaluationPeriods: 1
      MetricName: DiskSpaceUsedPercent
      TreatMissingData: breaching
    WarnLowDiskSpaceDockerPath:
      AlarmActions: warn
      Namespace: CWAgent
      ComparisonOperator: GreaterThanThreshold
      Dimensions: [ { Name: 'path', Value: '/var/lib/docker' }, { Name: 'host', Value: "${metric}" }, { Name: 'device', Value: 'xvdcz' }, { Name: 'fstype', Value: 'ext4' } ]
      Statistic: Maximum
      Threshold: 75   # Percentage used
      Period: 60
      EvaluationPeriods: 1
      MetricName: DiskSpaceUsedPercent
      TreatMissingData: breaching

  DiskINodeCheck:
    CritLowINodeCountAtRootPath:
      AlarmActions: crit
      Namespace: CWAgent
      ComparisonOperator: GreaterThanOrEqualToThreshold
      Dimensions: [ { Name: 'path', Value: '/' }, { Name: 'host', Value: "${metric}" }, { Name: 'device', Value: 'xvda1' }, { Name: 'fstype', Value: 'ext4' } ]
      Statistic: Maximum
      Threshold: 471859   # 90% full, based off 524288 inodes (a 7.8GB disk)
      Period: 60
      EvaluationPeriods: 1
      MetricName: INodesUsedCount
      TreatMissingData: breaching
    WarnLowINodeCountAtRootPath:
      AlarmActions: warn
      Namespace: CWAgent
      ComparisonOperator: GreaterThanOrEqualToThreshold
      Dimensions: [ { Name: 'path', Value: '/' }, { Name: 'host', Value: "${metric}" }, { Name: 'device', Value: 'xvda1' }, { Name: 'fstype', Value: 'ext4' } ]
      Statistic: Maximum
      Threshold: 419430   # 80% full, based off 524288 inodes (a 7.8GB disk)
      Period: 60
      EvaluationPeriods: 1
      MetricName: INodesUsedCount
      TreatMissingData: breaching
    CritLowINodeCountAtDataPath:
      AlarmActions: crit
      Namespace: CWAgent
      ComparisonOperator: GreaterThanOrEqualToThreshold
      Dimensions: [ { Name: 'path', Value: '/data' }, { Name: 'host', Value: "${metric}" }, { Name: 'device', Value: 'xvdf' }, { Name: 'fstype', Value: 'ext4' } ]
      Statistic: Maximum
      Threshold: 23592960   # 90% full, based off 26214400 inodes (a 394GB disk)
      Period: 60
      EvaluationPeriods: 1
      MetricName: INodesUsedCount
      TreatMissingData: breaching
    WarnLowINodeCountAtDataPath:
      AlarmActions: warn
      Namespace: CWAgent
      ComparisonOperator: GreaterThanOrEqualToThreshold
      Dimensions: [ { Name: 'path', Value: '/data' }, { Name: 'host', Value: "${metric}" }, { Name: 'device', Value: 'xvdf' }, { Name: 'fstype', Value: 'ext4' } ]
      Statistic: Maximum
      Threshold: 20971520   # 80% full, based off 26214400 inodes (a 394GB disk)
      Period: 60
      EvaluationPeriods: 1
      MetricName: INodesUsedCount
      TreatMissingData: breaching
    CritLowINodeCountAtDockerPath:
      AlarmActions: crit
      Namespace: CWAgent
      ComparisonOperator: GreaterThanOrEqualToThreshold
      Dimensions: [ { Name: 'path', Value: '/var/lib/docker' }, { Name: 'host', Value: "${metric}" }, { Name: 'device', Value: 'xvdcz' }, { Name: 'fstype', Value: 'ext4' } ]
      Statistic: Maximum
      Threshold: 20643840   # 90% full, based off 22937600 inodes (a 345GB disk)
      Period: 60
      EvaluationPeriods: 1
      MetricName: INodesUsedCount
      TreatMissingData: breaching
    WarnLowINodeCountAtDockerPath:
      AlarmActions: warn
      Namespace: CWAgent
      ComparisonOperator: GreaterThanOrEqualToThreshold
      Dimensions: [ { Name: 'path', Value: '/var/lib/docker' }, { Name: 'host', Value: "${metric}" }, { Name: 'device', Value: 'xvdcz' }, { Name: 'fstype', Value: 'ext4' } ]
      Statistic: Maximum
      Threshold: 18350080   # 80% full, based off 22937600 inodes (a 345GB disk)
      Period: 60
      EvaluationPeriods: 1
      MetricName: INodesUsedCount

  Memory: # Pushed by the CloudWatch agent
    HighMemoryUsage:
      AlarmActions: crit
      Namespace: CWAgent
      ComparisonOperator: GreaterThanOrEqualToThreshold
      Dimensions: [ { Name: 'host', Value: "${metric}" } ]
      Statistic: Maximum
      Threshold: 90   # Percentage used
      Period: 60
      EvaluationPeriods: 5
      MetricName: MemoryUsedPercent
      TreatMissingData: breaching

  AmazonMQBroker: # AWS::AmazonMQ::Broker
    CpuCreditBalanceCrit:
      AlarmActions: crit
      Namespace: AWS/AmazonMQ
      MetricName: CpuCreditBalance
      ComparisonOperator: LessThanThreshold
      Dimensions: [ { Name: 'Broker', Value: "${metric}" } ]
      Statistic: Minimum
      Threshold: 15
      EvaluationPeriods: 1
      TreatMissingData: notBreaching
    CpuCreditBalanceWarn:
      AlarmActions: warn
      Namespace: AWS/AmazonMQ
      MetricName: CpuCreditBalance
      ComparisonOperator: LessThanThreshold
      Dimensions: [ { Name: 'Broker', Value: "${metric}" } ]
      Statistic: Minimum
      Threshold: 30
      EvaluationPeriods: 1
      TreatMissingData: notBreaching
    CpuUtilizationCrit:
      AlarmActions: crit
      Namespace: AWS/AmazonMQ
      MetricName: CpuUtilization
      ComparisonOperator: GreaterThanThreshold
      Dimensions: [ { Name: 'Broker', Value: "${metric}" } ]
      Statistic: Maximum
      Threshold: 95
      Period: 60
      EvaluationPeriods: 3
      TreatMissingData: notBreaching
    CpuUtilizationWarn:
      AlarmActions: warn
      Namespace: AWS/AmazonMQ
      MetricName: CpuUtilization
      ComparisonOperator: GreaterThanThreshold
      Dimensions: [ { Name: 'Broker', Value: "${metric}" } ]
      Statistic: Maximum
      Threshold: 80
      Period: 60
      EvaluationPeriods: 3
      TreatMissingData: notBreaching
  SQSQueue:
    ApproximateAgeOfOldestMessage:
      AlarmActions: crit
      Namespace: AWS/SQS
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: QueueName
      Statistic: Average
      Threshold: 0.5
      Period: 60
      EvaluationPeriods: 5
      MetricName: ApproximateAgeOfOldestMessage
      TreatMissingData: notBreaching
    ApproximateNumberOfMessagesVisible:
      AlarmActions: crit
      Namespace: AWS/SQS
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: QueueName
      Statistic: Average
      Threshold: 0.5
      Period: 60
      EvaluationPeriods: 5
      MetricName: ApproximateNumberOfMessagesVisible
      TreatMissingData: notBreaching
  LambdaFunction: #AWS::Lambda::Function
    Throttles:
      AlarmActions: crit
      Namespace: AWS/Lambda
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: FunctionName
      Statistic: Average
      Threshold: 0.5
      Period: 60
      EvaluationPeriods: 5
      MetricName: Throttles
      TreatMissingData: notBreaching
    DeadLetterErrors:
      AlarmActions: crit
      Namespace: AWS/Lambda
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: FunctionName
      Statistic: Average
      Threshold: 0.5
      Period: 60
      EvaluationPeriods: 5
      MetricName: DeadLetterErrors
      TreatMissingData: notBreaching
  LambdaFunctionIteratorAge:
    IteratorAge:
      AlarmActions: crit
      Namespace: AWS/Lambda
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: FunctionName
      Statistic: Average
      Threshold: 600000
      Period: 60
      EvaluationPeriods: 5
      MetricName: IteratorAge
      TreatMissingData: notBreaching
  LambdaFunctionDuration:
    Duration:
      AlarmActions: crit
      Namespace: AWS/Lambda
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: FunctionName
      Statistic: Average
      Threshold: 30
      Period: 60
      EvaluationPeriods: 5
      MetricName: Duration
      TreatMissingData: notBreaching
  LambdaFunctionErrors:
    Errors:
      AlarmActions: crit
      Namespace: AWS/Lambda
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: FunctionName
      Statistic: Average
      Threshold: 0.5
      Period: 60
      EvaluationPeriods: 5
      MetricName: Errors
      TreatMissingData: notBreaching
  CloudFrontDistribution:
    4xxErrorRate:
      AlarmActions: warn
      Namespace: AWS/CloudFront
      ComparisonOperator: GreaterThanThreshold
      DimensionsName: DistributionId
      SecondaryDimensions: [ { Name: 'Region', Value: 'Global' }]
      Statistic: Sum
      Threshold: 5
      EvaluationPeriods: 2
      MetricName: 4xxErrorRate
      TreatMissingData: breaching
    5xxErrorRate:
      AlarmActions: warn
      Namespace: AWS/CloudFront
      ComparisonOperator: GreaterThanThreshold
      SecondaryDimensions: [ { Name: 'Region', Value: 'Global' }]
      DimensionsName: DistributionId
      Statistic: Average
      Threshold: 5
      EvaluationPeriods: 2
      MetricName: 5xxErrorRate
      TreatMissingData: breaching
    TotalErrorRate:
      AlarmActions: warn
      Namespace: AWS/CloudFront
      ComparisonOperator: GreaterThanThreshold
      SecondaryDimensions: [ { Name: 'Region', Value: 'Global' }]
      DimensionsName: DistributionId
      Statistic: Average
      Threshold: 5
      EvaluationPeriods: 5
      MetricName: TotalErrorRate
      TreatMissingData: breaching